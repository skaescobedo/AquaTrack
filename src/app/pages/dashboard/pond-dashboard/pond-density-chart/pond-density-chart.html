<div class="chart-card">
  <div class="chart-header">
    <div class="flex items-center gap-2">
      <lucide-icon [img]="Users" [size]="20" class="text-cyan-400"></lucide-icon>
      <h3 class="chart-title">Evolución de Densidad</h3>
    </div>
    @if (!isEmpty()) {
      <span class="chart-subtitle">Densidad a través del tiempo</span>
    }
  </div>

  @if (isEmpty()) {
    <div class="empty-state">
      <lucide-icon [img]="Users" [size]="48" class="text-slate-600"></lucide-icon>
      <p class="empty-text">No hay datos de densidad aún</p>
      <p class="empty-subtext">La densidad inicial aparecerá después de la siembra</p>
    </div>
  } @else {
    <div class="chart-content">
      <div class="chart-line-container">
        @for (point of data; track point.semana; let i = $index) {
          <div class="point-group">
            <!-- Punto -->
            <div class="point-wrapper">
              <div
                class="point"
                [style.bottom]="getLineHeight(point.densidad_org_m2)"
                [title]="point.densidad_org_m2.toFixed(2) + ' org/m²'"
              >
                <span class="point-value">{{ point.densidad_org_m2.toFixed(1) }}</span>
              </div>
              <!-- Línea al siguiente punto -->
              @if (i < data.length - 1) {
                <svg class="line-svg">
                  <line
                    [attr.x1]="'50%'"
                    [attr.y1]="getLineHeight(point.densidad_org_m2)"
                    [attr.x2]="'150%'"
                    [attr.y2]="getLineHeight(data[i + 1].densidad_org_m2)"
                    class="connection-line"
                  />
                </svg>
              }
            </div>
            <!-- Labels -->
            <span class="point-label">S{{ point.semana }}</span>
            <span class="point-date">{{ formatDate(point.fecha) }}</span>
          </div>
        }
      </div>
    </div>
  }
</div>