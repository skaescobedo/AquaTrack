<div class="cycle-dashboard-page">
  <!-- Loading State -->
  @if (loading()) {
    <div class="flex justify-center items-center py-20">
      <div class="spinner spinner-lg"></div>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="alert alert-danger">
      {{ error() }}
    </div>
  }

  <!-- No Cycle State -->
  @if (!loading() && !error() && !hasCycle) {
    <div class="empty-cycle-state">
      <div class="icon-wrapper">
        <lucide-icon [img]="Calendar" [size]="64"></lucide-icon>
      </div>
      <h2 class="title">No hay ciclo activo</h2>
      <p class="message">
        Crea un nuevo ciclo para esta granja y comienza a gestionar la producci√≥n
      </p>
      <button class="btn btn-primary btn-lg" (click)="openCreateCycleModal()">
        <lucide-icon [img]="Plus" [size]="20"></lucide-icon>
        <span>Crear Nuevo Ciclo</span>
      </button>
    </div>
  }

  <!-- Active Cycle Dashboard -->
  @if (!loading() && !error() && hasCycle) {
    <div class="dashboard-content">
      <!-- Header -->
      <div class="dashboard-header">
        <div>
          <h1 class="title">{{ overview()!.nombre }}</h1>
          <p class="subtitle">
            Iniciado el {{ formatDate(activeCycle()!.fecha_inicio) }}
          </p>
        </div>
        <div class="badge badge-success">
          {{ activeCycle()!.status }}
        </div>
      </div>

      <!-- Metrics (Componente modular) -->
      @if (overview()) {
        <app-cycle-metrics [kpis]="overview()!.kpis" />
      }

      <!-- Charts (Componente modular) -->
      @if (overview()) {
        <app-cycle-charts [graficas]="overview()!.graficas" />
      }

      <!-- Upcoming Seedings (Condicional) -->
      @if (hasUpcomingSeedings) {
        <app-upcoming-seedings [siembras]="overview()!.proximas_siembras" />
      }

      <!-- Upcoming Harvests (Condicional) -->
      @if (hasUpcomingHarvests) {
        <app-upcoming-harvests [cosechas]="overview()!.proximas_cosechas" />
      }

      <!-- Pond Details Table -->
      @if (overview()) {
        <app-pond-details-table [estanques]="overview()!.por_estanque" />
      }
    </div>
  }

  <!-- Modal de Crear Ciclo -->
  <app-create-cycle-modal
    [farmId]="farmId!"
    [farmName]="farmName()"
    [(show)]="showCreateModal"
    (cycleCreated)="onCycleCreated()">
  </app-create-cycle-modal>
</div>