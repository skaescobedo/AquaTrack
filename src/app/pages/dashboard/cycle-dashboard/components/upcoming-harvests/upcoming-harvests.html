<div class="upcoming-harvests-section">
  <div class="section-header">
    <div class="flex items-center gap-2">
      <lucide-icon [img]="Package" [size]="20" class="text-blue-400"></lucide-icon>
      <h3 class="section-title">Próximas Cosechas</h3>
    </div>
    <span class="badge badge-neutral">{{ cosechas.length }} programadas</span>
  </div>

  <div class="harvests-timeline">
    <!-- ✅ CORREGIDO: Usar trackByCosechaId y cosecha_ola_id -->
    @for (cosecha of cosechas; track trackByCosechaId($index, cosecha)) {
      <div class="harvest-card">
        <div class="card-header">
          <div class="flex items-center gap-2">
            <!-- ✅ CORREGIDO: Usar cosecha_ola_id en lugar de ola_id -->
            <span class="ola-number">{{ cosecha.cosecha_ola_id }}</span>
            <div>
              <h4 class="ola-nombre">Cosecha {{ cosecha.tipo === 'p' ? 'Parcial' : 'Final' }}</h4>
              <span class="badge badge-sm" [ngClass]="getTipoBadgeClass(cosecha.tipo)">
                {{ cosecha.tipo === 'p' ? 'Parcial' : 'Final' }}
              </span>
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="info-row">
            <lucide-icon [img]="Calendar" [size]="16" class="text-slate-400"></lucide-icon>
            <span class="text-slate-300">{{ formatDateRange(cosecha.ventana_inicio, cosecha.ventana_fin) }}</span>
          </div>

          <div class="info-row">
            <!-- ✅ CORREGIDO: Usar dias_diferencia en lugar de dias_hasta_inicio -->
            <span class="dias-label">En {{ cosecha.dias_diferencia }} días</span>
            <span class="estanques-count">{{ cosecha.estanques_pendientes }} estanques</span>
          </div>
        </div>

        <div class="card-footer">
          <span class="badge" [ngClass]="getEstadoBadgeClass(cosecha.estado)">
            {{ cosecha.estado }}
          </span>
        </div>
      </div>
    }
  </div>
</div>