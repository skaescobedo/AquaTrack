<div class="harvest-item" [class]="viewMode === 'list' ? 'list-view' : 'grid-view'">
  <!-- Header -->
  <div class="item-header">
    <div class="header-left">
      <h3 class="pond-name">{{ harvest.pond_name }}</h3>
      <span class="pond-area">{{ harvest.pond_superficie.toLocaleString() }} m²</span>
    </div>

    <div class="header-right">
      <span class="status-badge" [ngClass]="statusBadgeClass">
        @if (isConfirmed) {
          <lucide-icon [img]="Check" [size]="14"></lucide-icon>
        }
        {{ statusLabel }}
      </span>
    </div>
  </div>

  <div class="item-body">
    @if (!isEditing()) {
      <!-- View Mode -->
      <div class="harvest-details">
        <!-- Fecha -->
        <div class="detail-row">
          <lucide-icon [img]="Calendar" [size]="16" class="detail-icon"></lucide-icon>
          <div class="detail-content">
            <span class="detail-label">Fecha de cosecha:</span>
            <span class="detail-value">{{ formatDate(harvest.fecha_cosecha) }}</span>
          </div>
        </div>

        <!-- Datos confirmados (si aplica) -->
        @if (isConfirmed) {
          <div class="confirmed-data">
            @if (harvest.pp_g) {
              <div class="data-item">
                <span class="data-label">PP:</span>
                <span class="data-value">{{ harvest.pp_g }} g</span>
              </div>
            }

            @if (harvest.biomasa_kg) {
              <div class="data-item">
                <span class="data-label">Biomasa:</span>
                <span class="data-value">{{ harvest.biomasa_kg.toLocaleString('es-MX', { maximumFractionDigits: 1 }) }} kg</span>
              </div>
            }

            @if (harvest.densidad_retirada_org_m2) {
              <div class="data-item">
                <span class="data-label">Retiro:</span>
                <span class="data-value">{{ harvest.densidad_retirada_org_m2 }} org/m²</span>
              </div>
            }
          </div>
        }

        <!-- Notas -->
        @if (harvest.notas) {
          <div class="notes">
            <p class="notes-text">{{ harvest.notas }}</p>
          </div>
        }
      </div>

      <!-- Actions -->
      <div class="item-actions">
        @if (canEdit) {
          <button
            class="btn btn-secondary btn-sm"
            (click)="startEdit()"
          >
            <lucide-icon [img]="Edit2" [size]="16"></lucide-icon>
            <span>Reprogramar</span>
          </button>
        }

        @if (canConfirm) {
          <button
            class="btn btn-success btn-sm"
            (click)="onConfirmClick()"
          >
            <lucide-icon [img]="Check" [size]="16"></lucide-icon>
            <span>Confirmar</span>
          </button>
        }
      </div>

    } @else {
      <!-- Edit Mode -->
      <div class="edit-form">
        <div class="form-group">
          <label for="editDate" class="form-label">Nueva fecha</label>
          <input
            id="editDate"
            type="date"
            [(ngModel)]="editDate"
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="editMotivo" class="form-label">Motivo del cambio</label>
          <textarea
            id="editMotivo"
            [(ngModel)]="editMotivo"
            class="form-textarea"
            placeholder="Ej: Clima adverso"
            rows="2"
          ></textarea>
        </div>

        <div class="edit-actions">
          <button
            class="btn btn-secondary btn-sm"
            (click)="cancelEdit()"
          >
            <lucide-icon [img]="X" [size]="16"></lucide-icon>
            <span>Cancelar</span>
          </button>

          <button
            class="btn btn-primary btn-sm"
            (click)="saveEdit()"
            [disabled]="!editDate"
          >
            <lucide-icon [img]="Check" [size]="16"></lucide-icon>
            <span>Guardar</span>
          </button>
        </div>
      </div>
    }
  </div>
</div>