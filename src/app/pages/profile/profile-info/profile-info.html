<!-- profile-info/profile-info.html -->
<div class="profile-card">
  <div class="card-header">
    <div class="header-left">
      <div class="avatar">{{ userInitials }}</div>
      <div>
        <h3 class="card-title">Información Personal</h3>
        <p class="card-subtitle">Tus datos de perfil</p>
      </div>
    </div>
    @if (!isEditing()) {
      <button class="btn btn-ghost btn-icon" (click)="startEdit()">
        <lucide-icon [img]="Edit2" [size]="18"></lucide-icon>
      </button>
    }
  </div>

  <div class="card-body">
    @if (error()) {
      <div class="alert alert-danger mb-4">
        {{ error() }}
      </div>
    }

    @if (!isEditing()) {
      <!-- Vista modo lectura -->
      <div class="info-grid">
        <div class="info-item">
          <lucide-icon [img]="UserIcon" [size]="16" class="text-slate-400"></lucide-icon>
          <div>
            <span class="info-label">Nombre</span>
            <span class="info-value">{{ fullName }}</span>
          </div>
        </div>

        <div class="info-item">
          <lucide-icon [img]="Mail" [size]="16" class="text-slate-400"></lucide-icon>
          <div>
            <span class="info-label">Email</span>
            <span class="info-value">{{ user.email }}</span>
          </div>
        </div>

        @if (user.is_admin_global) {
          <div class="info-item">
            <lucide-icon [img]="Shield" [size]="16" class="text-purple-400"></lucide-icon>
            <div>
              <span class="info-label">Rol Global</span>
              <span class="badge badge-admin">Administrador Global</span>
            </div>
          </div>
        }
      </div>
    } @else {
      <!-- Modo edición -->
      <form (ngSubmit)="saveChanges()">
        <div class="form-grid">
          <div class="form-group">
            <label for="nombre">Nombre</label>
            <input
              id="nombre"
              type="text"
              [(ngModel)]="nombre"
              name="nombre"
              placeholder="Juan"
              required
            />
          </div>

          <div class="form-group">
            <label for="apellido1">Primer Apellido</label>
            <input
              id="apellido1"
              type="text"
              [(ngModel)]="apellido1"
              name="apellido1"
              placeholder="Pérez"
              required
            />
          </div>

          <div class="form-group">
            <label for="apellido2">Segundo Apellido</label>
            <input
              id="apellido2"
              type="text"
              [(ngModel)]="apellido2"
              name="apellido2"
              placeholder="García (opcional)"
            />
          </div>

          <div class="form-group">
            <label for="email">Correo Electrónico</label>
            <input
              id="email"
              type="email"
              [(ngModel)]="email"
              name="email"
              placeholder="juan@aquatrack.com"
              required
            />
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="cancelEdit()"
            [disabled]="isLoading()"
          >
            <lucide-icon [img]="X" [size]="16"></lucide-icon>
            <span>Cancelar</span>
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="isLoading()"
          >
            @if (isLoading()) {
              <span class="spinner"></span>
              <span>Guardando...</span>
            } @else {
              <lucide-icon [img]="Check" [size]="16"></lucide-icon>
              <span>Guardar Cambios</span>
            }
          </button>
        </div>
      </form>
    }
  </div>
</div>