<!-- user-card.html -->
<div class="user-card" [class.current-user]="isCurrentUser">
  <!-- Header Section: Avatar, Status Badge & Menu -->
  <div class="card-header-section flex items-start justify-between mb-4">
    <div class="flex items-center gap-3">
      <div class="avatar-container">
        <div class="avatar">{{ initials }}</div>
        <!-- ✨ Badge "Tú" para el usuario actual -->
        @if (isCurrentUser) {
          <div class="current-user-badge">Tú</div>
        }
      </div>
      <div class="user-status" [ngClass]="user.status === 'a' ? 'active' : 'inactive'">
        {{ user.status === 'a' ? 'Activo' : 'Inactivo' }}
      </div>
    </div>
    
    <!-- Solo mostrar menú si NO es el usuario actual -->
    @if (!isCurrentUser) {
      <div class="relative">
        <button 
          class="btn btn-ghost btn-icon"
          (click)="toggleMenu()"
        >
          <lucide-icon [img]="MoreVertical" [size]="20"></lucide-icon>
        </button>

        @if (showMenu) {
          <div class="dropdown-menu">
            <button class="dropdown-item" (click)="onEdit()">Editar información</button>
            <button class="dropdown-item" (click)="onChangePermissions()">Cambiar permisos</button>
            <button class="dropdown-item" (click)="onResetPassword()">Restablecer contraseña</button>
            
            @if (user.status === 'a') {
              <button class="dropdown-item text-red-400" (click)="onDeactivate()">Desactivar usuario</button>
            } @else {
              <button class="dropdown-item text-green-400" (click)="onActivate()">Activar usuario</button>
            }
          </div>
        }
      </div>
    }
  </div>

  <!-- Info Section: User Info & Role -->
  <div class="card-info-section">
    <!-- User Info -->
    <div>
      <h3 class="text-lg font-semibold text-white mb-1">{{ fullName }}</h3>
      
      <div class="flex items-center gap-2 text-sm text-slate-400">
        <lucide-icon [img]="Mail" [size]="14"></lucide-icon>
        <span class="truncate">{{ user.email }}</span>
      </div>
    </div>

    <!-- Role Badge -->
    @if (user.is_admin_global) {
      <div class="flex items-center gap-2">
        <lucide-icon [img]="Shield" [size]="16" class="text-purple-400"></lucide-icon>
        <span class="badge badge-info">Admin Global</span>
      </div>
    }
  </div>

  <!-- Footer Section: Farms Count -->
  <div class="card-footer-section">
    <div class="text-sm text-slate-400 flex items-center gap-2">
      <lucide-icon [img]="UserIcon" [size]="14"></lucide-icon>
      @if (user.is_admin_global) {
        <span>Granjas (todas)</span>
      } @else {
        <span>Granjas ({{ user.farms_count }})</span>
      }
    </div>
  </div>
</div>